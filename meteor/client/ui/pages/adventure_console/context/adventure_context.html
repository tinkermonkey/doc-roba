<template name="AdventureContext">
  {{#with getNode}}
    <div class="node-edit-form {{#unless adventureIsStill ../adventure.get}}hide{{/unless}}" data-node-id="{{_id}}">
      <div class="btn btn-warning pull-right btn-wrong-node"
           data-toggle="popover"
           data-trigger="focus"
           data-content="This is not the correct node"
      >X
      </div>
      <div>
        {{#unless isMatch this ..}}
          <div class="alert alert-warning">
            The current node does <i>not</i> match the data below:
            {{#with nodeComparison this ..}}
              {{> Template.dynamic template=searchComparisonPanel }}
            {{/with}}
          </div>
        {{/unless}}
      </div>
      
      <div class="edit-node-params">
        <div>
          <span class="field-label">Type:</span>
          {{> EditableNodeType cssClass="inline-block" pageView=true value=type dataKey="type" emptyText="Select a node type" }}
        </div>
        <div>
          <span class="field-label">Name:</span>
          {{> EditableTextField cssClass="inline-block" value=title dataKey="title" emptyText="none"}}
        </div>
        {{> Template.dynamic template=editParamsPanel }}
      </div>
      
      <h3 class="section grey">Node Ready Code</h3>
      {{> EditableCode value=readyCode dataKey="readyCode" emptyText="Code to validate that the node is ready" color="grey" minLines=3 maxLines=20}}
      
      <h3 class="section grey">Node Valid Code</h3>
      {{> EditableCode value=validationCode dataKey="validationCode" emptyText="Code to validate the node is correct" color="grey" minLines=3 maxLines=20}}
    
    </div>
  {{else}}
    <div class="{{#unless adventureIsStill adventure.get}}hide{{/unless}}">
      <div class="full-width align-center">
        {{> EditableNodeSelector cssClass="current-node-selector" dataKey="currentNodeId" emptyText="Select Node" projectVersionId=adventure.get.projectVersionId}}
      </div>
      <div class="full-width align-center">
        <button class="btn btn-primary btn-add-node" data-type="page">Add Node</button>
      </div>
      <div class="full-width add-node-form hide">
        {{> AdventureAddNodeForm }}
      </div>
      <div class="node-url-search">
        <label>Best Matches:</label>
        {{> NodeUrlSearchResults searchNodes}}
      </div>
    </div>
  {{/with}}
</template>