<template name="AdventureScreen">
  <div class="adventure-screen-container">
    {{#if state.get.screenshot}}
      {{updateViewport}}
      <img class="remote-screen" src="data:image/png;base64,{{state.get.screenshot}}"
           style="{{#with screenSize}}height: {{height}}px; width: {{width}}px;{{/with}}">
      <div class="remote-screen-mask"
           style="{{#with maskPosition}}top: {{top}}px; left: {{left}}px; height: {{height}}px; width: {{width}}px;{{/with}}">
        
        {{#unless adventureIsComplete adventure.get}}
          {{> RemoteScreenPointer }}
          {{> RemoteScreenTools }}
        {{/unless}}
        
        <div class="adventure-hover-element-highlight" style="visibility: hidden;"></div>
        
        {{> AdventureHoverControls }}
        
        {{#each highlightElements.get}}
          {{#with processHighlightElement @index}}
            {{> HighlightElement }}
          {{/with}}
        {{/each}}
      </div>
      
      {{#unless adventureIsComplete adventure.get}}
        {{> AdventureToolbar }}
      {{/unless}}
      
      {{#if getCheckResult}}
        {{#with getCheckResult}}
          <div class="well">
            {{> AdventureSelectorResult currentNodeId=../currentNodeId.get adventure=../adventure.get}}
            {{#each selectors}}
              {{> AdventureSelectorResult selector=this currentNodeId=../../currentNodeId.get adventure=../../adventure.get}}
            {{/each}}
          </div>
        {{/with}}
      {{/if}}
  
      {{#each highlightElements.get}}
        {{#with processHighlightElement @index}}
          {{> HighlightElementDetail }}
        {{/with}}
      {{/each}}
      
    {{else}}
      <div class="remote-screen remote-screen-loading">
        <div class="remote-screen-loading-log">
          {{> AdventureLogEmbedded }}
        </div>
        {{#unless adventureIsStill }}
          {{> RobaSpinner }}
        {{/unless}}
      </div>
    {{/if}}
  </div>
</template>